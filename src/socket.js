// TODO move socket code into this file